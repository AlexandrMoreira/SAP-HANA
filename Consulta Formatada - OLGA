SELECT 
	T3."KNDNAME", T2."U_SPS_PRVD_TipoAcabamento"
   ,T2."ItemCode" "COR" /*T2."U_SPS_PROD_RalTinta"*/
   ,CASE WHEN "APSSTATUS"=1 THEN SUM(T1.TOTALQUANTITY_WHUNIT) ELSE 0 END "PESO_PROGRAMADO"
   ,CASE WHEN "APSSTATUS"=0 THEN SUM(T1.TOTALQUANTITY_WHUNIT) ELSE 0 END "PESO_PROGRAMAR"
   ,CASE WHEN T2."U_SPS_PROD_VolumeMinAcabamento"
   -SUM(T1.TOTALQUANTITY_WHUNIT) < 0 THEN 0 ELSE T2."U_SPS_PROD_VolumeMinAcabamento"-SUM(T1.TOTALQUANTITY_WHUNIT) END "PESOMIN"
FROM 
BEAS_FTAPL  T0
INNER JOIN BEAS_FTSTL T1 ON T1.BELNR_ID = T0.BELNR_ID and T1.BELPOS_ID = T0.BELPOS_ID
INNER JOIN OITM T2 ON T2."ItemCode" = T1.ART1_ID
INNER JOIN BEAS_FTHAUPT T3 ON T3.BELNR_ID = T0.BELNR_ID
WHERE AG_ID IN ('PINTURA','ANODIZAR') 
	and T2."U_SPS_PRVD_Acabamento"='Y'
	--and T2."U_SPS_PRVD_TipoAcabamento" in ('Pintura','Decoral')--
	/*and  T2."U_SPS_PROD_RalTinta" is not null*/
GROUP BY  T2."U_SPS_PRVD_TipoAcabamento", T3."KNDNAME",T2."ItemCode",T2."U_SPS_PROD_VolumeMinAcabamento","APSSTATUS" /*T2."U_SPS_PROD_RalTinta"*/
HAVING SUM(T1.TOTALQUANTITY_WHUNIT) > 0
ORDER BY 2 DESC
